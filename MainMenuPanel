import java.awt.*;
import javax.swing.*;
import java.awt.image.*;
import javax.imageio.ImageIO;
import java.io.*;
import java.awt.event.MouseListener;
import java.awt.event.MouseEvent;
import java.awt.event.MouseMotionListener;
import java.awt.geom.AffineTransform;

import javax.swing.border.Border;

public class MainMenuPanel extends JPanel implements Runnable, MouseListener, MouseMotionListener {
    private String word;
    private float transparency;
    private int xloc, yloc, fontSize;
    private BufferedImage background;   // The full background (splendorbackground.jpg)
    private BufferedImage splendorImage; // The center image (weeedwd.jpg)
    private BufferedImage rulesButton;  // Rules button as an image
    private int phase;
    private JButton playButton;   // Play button as JButton
    private int theta = 0;
    private boolean animate = false;
    private boolean forward = true;
    private GameBoardPanel gameBoardPanel;
    private int rulesButtonX = -100, rulesButtonY = -50; // Adjusted further to the left
    private boolean playButtonPositionSet = false;

    public MainMenuPanel(boolean bool) {
        phase = 0;
        gameBoardPanel = new GameBoardPanel();
        new Thread(() -> gameBoardPanel.loadImages()).start();
        transparency = 0.01f;
        word = "PAULOLDS PRESENTS";
        xloc = 450; yloc = 550; fontSize = 100;

        try {
            background = ImageIO.read(MainMenuPanel.class.getResource("/splendorImages/MainMenuBackground.jpg"));
            splendorImage = ImageIO.read(MainMenuPanel.class.getResource("/splendorImages/splendorLogo.jpg"));
            rulesButton = ImageIO.read(MainMenuPanel.class.getResource("/splendorImages/rulesButton.PNG"));
        } catch (IOException e) {
            e.printStackTrace();
        }

        playButton = new JButton("Play");
        playButton.setFont(new Font("Arial", Font.BOLD, 48));
        playButton.setBackground(Color.WHITE);
        playButton.setForeground(Color.BLACK);
        playButton.setFocusPainted(false);
        playButton.setBorder(new RoundedBorder(20));
        playButton.setSize(400, 150);
        
        playButton.addMouseListener(new java.awt.event.MouseAdapter() {
            @Override
            public void mouseEntered(java.awt.event.MouseEvent evt) {
                playButton.setBackground(new Color(60, 60, 60));
                playButton.setForeground(new Color(255, 0, 255));
            }

            @Override
            public void mouseExited(java.awt.event.MouseEvent evt) {
                playButton.setBackground(Color.WHITE);
                playButton.setForeground(Color.BLACK);
            }

            @Override
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                JFrame topFrame = (JFrame) SwingUtilities.getWindowAncestor(MainMenuPanel.this);
                topFrame.getContentPane().removeAll();
                topFrame.add(gameBoardPanel);
                topFrame.revalidate();
                topFrame.repaint();
            }
        });

        if (!bool) {
            phase = 1;
            setPlayButtonPosition();
            add(playButton);
        } else {
            new Thread(() -> {
                animateStart();
                animateStart();
                phase = 1;
                setPlayButtonPosition();
                SwingUtilities.invokeLater(() -> add(playButton));
                repaint();
            }).start();
        }

        addMouseListener(this);
        addMouseMotionListener(this);
        setFocusable(true);
    }

    @Override
    public void addNotify() {
        super.addNotify();
        SwingUtilities.invokeLater(this::setPlayButtonPosition);
    }

    private void setPlayButtonPosition() {
        if (!playButtonPositionSet) {
            int imageWidth = getWidth() / 3;
            int imageHeight = getHeight() / 3;
            int imageX = (getWidth() - imageWidth) / 2;
            int imageY = (getHeight() - imageHeight) / 2 - 50;
            int playButtonX = imageX + (imageWidth - playButton.getWidth()) / 2;
            int playButtonY = imageY + imageHeight - 1000;
            playButton.setBounds(playButtonX, playButtonY, playButton.getPreferredSize().width, playButton.getPreferredSize().height);
            //playButton.setLocation(playButtonX, playButtonY);
            playButtonPositionSet = true;
        }
    }

    @Override
    protected void paintComponent(Graphics g) {
        super.paintComponent(g);
        Graphics2D g2d = (Graphics2D) g;

        if (phase == 0) {
            g2d.setColor(Color.DARK_GRAY);
            g2d.fillRect(0, 0, getWidth(), getHeight());
            g2d.setColor(Color.WHITE);
            g2d.setComposite(AlphaComposite.getInstance(AlphaComposite.SRC_OVER, transparency));
            g2d.setFont(new Font("TIMES NEW ROMAN", Font.BOLD, fontSize));
            g2d.drawString(word, xloc, yloc);
        } else if (phase == 1) {
            g2d.setComposite(AlphaComposite.getInstance(AlphaComposite.SRC_OVER, 0.7f));
            g2d.drawImage(background, 0, 0, getWidth(), getHeight(), null);

            int imageWidth = getWidth() / 3;
            int imageHeight = getHeight() / 3;
            int imageX = (getWidth() - imageWidth) / 2;
            int imageY = (getHeight() - imageHeight) / 2 - 50;
            g2d.drawImage(splendorImage, imageX, imageY, imageWidth, imageHeight, null);

            AffineTransform originalTransform = g2d.getTransform();

            g2d.rotate(Math.toRadians(theta), rulesButtonX + rulesButton.getWidth() / 2, rulesButtonY + rulesButton.getHeight() / 2);
            g2d.drawImage(rulesButton, rulesButtonX, rulesButtonY, rulesButton.getWidth() + 100, rulesButton.getHeight() + 100, null);

            g2d.setTransform(originalTransform);
            paintChildren(g2d);
        }
    }

    @Override
    public void mouseClicked(MouseEvent e) {
        int mouseX = e.getX();
        int mouseY = e.getY();

        // Calculate Rules button bounds after applying transformation
        if (phase == 1) {
            int rulesButtonWidth = rulesButton.getWidth() + 100;
            int rulesButtonHeight = rulesButton.getHeight() + 100;
            
            AffineTransform transform = new AffineTransform();
            transform.rotate(Math.toRadians(theta), rulesButtonX + rulesButtonWidth / 2, rulesButtonY + rulesButtonHeight / 2);
            Shape transformedRulesButton = transform.createTransformedShape(new Rectangle(rulesButtonX, rulesButtonY, rulesButtonWidth, rulesButtonHeight));
            
            if (transformedRulesButton.contains(mouseX, mouseY)) {
                // Rules button clicked, show the rules
                JFrame topFrame = (JFrame) SwingUtilities.getWindowAncestor(this);
                topFrame.getContentPane().removeAll();
                topFrame.add(new RulesPanel()); // Navigate to RulesPanel
                topFrame.revalidate();
                topFrame.repaint();
            }
        }
    }


    public void mouseReleased(MouseEvent e) { }

    public void mousePressed(MouseEvent e) { }

    public void mouseEntered(MouseEvent e) { }

    public void mouseMoved(MouseEvent e) {
        // Continuously check if the mouse is over the rulesButton
        int mouseX = e.getX();
        int mouseY = e.getY();

        boolean isOverRulesButton = (mouseX >= rulesButtonX && mouseX <= rulesButtonX + rulesButton.getWidth() &&
                mouseY >= rulesButtonY && mouseY <= rulesButtonY + rulesButton.getHeight());

        if (isOverRulesButton && !animate) {
            animate = true;
            theta = -30;
            new Thread(this::animateRules).start();
        } else if (!isOverRulesButton && animate) {
            animate = false;
            theta = 0;
            rulesButtonX = -100;
            rulesButtonY = -50; // Adjusted further to the left
            repaint();
        }
    }

    public void mouseDragged(MouseEvent e) { }

    public void mouseExited(MouseEvent e) { }

    public void animateStart() {
        while (transparency < 0.99) {
            transparency += 0.01;
            repaint();
            try {
                Thread.sleep(10);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
        while (transparency > 0.01) {
            transparency -= 0.01;
            repaint();
            try {
                Thread.sleep(10);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
        word = "Splendor";
        transparency = 0.01f;
        xloc = 590;
        yloc = 540;
        fontSize = 200;
    }

    public void animateRules() {
        while (animate) {
            if (theta == 30) {
                forward = true;
            } else if (theta == -30) {
                forward = false;
            }
            if (forward) {
                theta = theta - 1;
                rulesButtonX++;
                rulesButtonY--;
            } else {
                theta = theta + 1;
                rulesButtonX--;
                rulesButtonY++;
            }
            repaint();
            try {
                Thread.sleep(10);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
    }

    @Override
    public void run() { }

    // Custom Border class for rounded corners
    class RoundedBorder implements Border {
        private int radius;

        RoundedBorder(int radius) {
            this.radius = radius;
        }

        public Insets getBorderInsets(Component c) {
            return new Insets(this.radius + 1, this.radius + 1, this.radius + 2, this.radius);
        }

        public boolean isBorderOpaque() {
            return true;
        }

        public void paintBorder(Component c, Graphics g, int x, int y, int width, int height) {
            Graphics2D g2d = (Graphics2D) g;
            g2d.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);
            g2d.drawRoundRect(x, y, width - 1, height - 1, radius, radius);
        }
    }
}
